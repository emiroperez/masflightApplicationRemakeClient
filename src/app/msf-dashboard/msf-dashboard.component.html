<div id="msf-dashboard-element" #scrollContainer (click)="disableContextMenu()" (contextmenu)="disableContextMenu()" (scroll)="disableContextMenu()" class="msf-dashboard-container" [style.height]="screenHeight" [ngStyle]="{ 'cursor': getHoverCursor() }">
  <!-- ngClass must be used for the control variable overlay it can override the overlays used on some dialogs such as the wizard -->
  <div [ngClass]="{ 'msf-control-variables-overlay': !controlVariableDialogOpen }">
    <div class="msf-dashboard-header" *ngIf="currentDashboardMenu">
      <div class="msf-dashboard-title">
        <span class="msf-dashboard-title-label">
          {{currentDashboardMenu.title}}
          <span *ngIf="globals.readOnlyDashboard">
           (Read Only)
          </span>
        </span>
        <div [ngClass]="{ 'msf-dashboard-control-panel-button' : !controlPanelOpen, 'msf-dashboard-control-panel-button-open' : controlPanelOpen }" (click)="toggleControlPanel()" *ngIf="!globals.readOnlyDashboard">
          <div class="msf-dashboard-control-panel-icon"></div>
          Control Panel
          <mat-icon *ngIf="!controlPanelOpen" class="msf-dashboard-control-panel-button-arrow" aria-label="open">arrow_drop_down</mat-icon>
          <mat-icon *ngIf="controlPanelOpen" class="msf-dashboard-control-panel-button-arrow" aria-label="open">arrow_drop_up</mat-icon>
        </div>
      </div>
    </div>
    <app-msf-dashboard-control-panel #dashboardControlPanel (updateAllPanels)="updateAllPanels()" (hideCategoryFromCharts)="hideCategoryFromCharts($event)" [controlPanelOpen]="controlPanelOpen" [controlVariablesAvailable]="controlVariablesAvailable" [controlPanelCategories]="controlPanelCategories"></app-msf-dashboard-control-panel>

    <button (click)="addP()">Add panel</button>
    <button (click)="checkP()">Check panels</button>

    <div lb-gridstack width="12" [options]="gridStackOptions" (change)="dashboardChanged($event)">
      <div lb-gridstack-item *ngFor="let panel of widgets" x="{{panel.x}}" y="{{panel.y}}" width="{{panel.w}}" height="{{panel.h}}" min-width="4" min-height="5">
        <div [ngClass]="panel.values.isLoading? 'tab-show loading-panel' : 'tab-hide'" id="msf-dashboard-panel-loading" class="msf-dashboard-panel-loading">
          <div class="msf-dashboard-panel-button msf-dashboard-panel-loading-button">
            <mat-icon class="msf-dashboard-button-close-icon" aria-label="close">close</mat-icon>
            <div class="msf-dashboard-button-move-icon" *ngIf="!globals.readOnlyDashboard" (click)="disableContextMenu()"></div>
          </div>
          <button *ngIf="panel.values.isLoading" mat-button class="cancel-button" (click)="cancelLoading(panel.values)">
            Cancel
            <mat-icon class="close-icon">close</mat-icon> 
          </button>
        </div>
        <div class="msf-dashboard-panel-button" *ngIf="!globals.readOnlyDashboard">
          <mat-icon class="msf-dashboard-button-close-icon" aria-label="close">close</mat-icon>
          <div class="msf-dashboard-button-move-icon" (click)="disableContextMenu()"></div>
        </div>
        <app-msf-dashboard-panel [values]="panel.values" [reAppendChart]="dashboardColumnsReAppendCharts[column]"
          [controlPanelVariables]="controlPanelVariables" [currentHiddenCategories]="currentHiddenCategories" (removeDeadVariablesAndCategories)="removeDeadVariablesAndCategories($event)"
          (addNewVariablesAndCategories)="addNewVariablesAndCategories($event)" (toggleControlVariableDialogOpen)="toggleControlVariableDialogOpen($event)"
          (removePanel)="removePanel(column, row)">
        </app-msf-dashboard-panel>
      </div>
    </div>
    <!--
    <div class="msf-dashboard-empty" *ngIf="!dashboardColumns.length">
      You have not added any panel.<br>
      Click here to start!
    </div>
    <div class="msf-dashboard-addmenu" *ngIf="!globals.readOnlyDashboard">
      <div class="msf-dashboard-addmenu-item" (click)="toggleDisplayAddPanel()">
        <div class="msf-dashboard-addmenu-item-text">
          <mat-icon class="msf-dashboard-icon" aria-label="add">add</mat-icon>
          <span class="msf-dashboard-addmenu-item-addtext">ADD PANELS</span>
        </div>
      </div>
      <div class="msf-dashboard-addmenu-item" *ngIf="displayAddPanel">
        <div class="msf-dashboard-addmenu-item-text" (click)="addPanel(1)">1 Panel</div>
      </div>
      <div class="msf-dashboard-addmenu-item" *ngIf="displayAddPanel">
        <div class="msf-dashboard-addmenu-item-text" (click)="addPanel(2)">2 Panels</div>
      </div>
      <div class="msf-dashboard-addmenu-item" *ngIf="displayAddPanel">
        <div class="msf-dashboard-addmenu-item-text" (click)="addPanel(3)">3 Panels</div>
      </div>
      <div class="msf-dashboard-addmenu-item" *ngIf="displayAddPanel">
        <div class="msf-dashboard-addmenu-item-text" (click)="addPanel(4)">4 Panels</div>
      </div>
    </div>
    -->
    <div *ngIf="displayContextMenu">
      <div class="msf-dashboard-panel-context-menu" [style.left.px]="getContextMenuPosX()" [style.top.px]="getContextMenuPosY()">
        <div id="msf-dashboard-panel-context-menu-container">
          <div class="msf-dashboard-panel-context-menu-top-bound"></div>
          <button class="msf-dashboard-panel-context-menu-item" mat-menu-item *ngFor="let item of contextMenuItems" (click)="displayChildPanel(item.id)">
            <span>{{item.title}}</span>
          </button>
          <div class="msf-dashboard-panel-context-menu-bottom-bound"></div>
        </div>
      </div>
    </div>
  </div>
</div>