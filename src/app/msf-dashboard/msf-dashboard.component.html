<div id="msf-dashboard-element" #scrollContainer (click)="disableContextMenu()" (contextmenu)="disableContextMenu()" (scroll)="disableContextMenu()" class="msf-dashboard-container" [style.height]="screenHeight">
  <!-- ngClass must be used for the control variable overlay it can override the overlays used on some dialogs such as the wizard -->
  <div [ngClass]="{ 'msf-control-variables-overlay': !controlVariableDialogOpen }">
    <div class="msf-dashboard-header" *ngIf="currentDashboardMenu">
      <div class="msf-dashboard-title">
        <span class="msf-dashboard-title-label">
          {{currentDashboardMenu.title}}
          <span *ngIf="globals.readOnlyDashboard">
           (Read Only)
          </span>
        </span>
        <div [ngClass]="{ 'msf-dashboard-control-panel-button' : !controlPanelOpen, 'msf-dashboard-control-panel-button-open' : controlPanelOpen }" (click)="toggleControlPanel()" *ngIf="!globals.readOnlyDashboard">
          <div class="msf-dashboard-control-panel-icon"></div>
          Control Panel
          <mat-icon *ngIf="!controlPanelOpen" class="msf-dashboard-control-panel-button-arrow" aria-label="open">arrow_drop_down</mat-icon>
          <mat-icon *ngIf="controlPanelOpen" class="msf-dashboard-control-panel-button-arrow" aria-label="open">arrow_drop_up</mat-icon>
        </div>
      </div>
    </div>
    <app-msf-dashboard-control-panel #dashboardControlPanel (updateAllPanels)="updateAllPanels()" (hideCategoryFromCharts)="hideCategoryFromCharts($event)" [controlPanelOpen]="controlPanelOpen" [controlVariablesAvailable]="controlVariablesAvailable" [controlPanelCategories]="controlPanelCategories"></app-msf-dashboard-control-panel>
    <div class="msf-dashboard-gridstack" lb-gridstack width="12" [options]="gridStackOptions" (change)="onDashboardChange($event)" *ngIf="dashboardPanels.length">
      <div lb-gridstack-item *ngFor="let panel of dashboardPanels" [id]="panel.gridId" [x]="panel.x" [y]="panel.y" [width]="panel.width" [height]="panel.height" [auto-position]="panel.autoposition" min-width="3" min-height="7" (contextmenu)="onRightClick($event, panel)">
        <div [ngClass]="panel.isLoading ? 'tab-show loading-panel' : 'tab-hide'" id="msf-dashboard-panel-loading" class="msf-dashboard-panel-loading">
          <div class="msf-dashboard-panel-button msf-dashboard-panel-loading-button">
            <mat-icon class="msf-dashboard-button-close-icon" (click)="removePanel(panel.id)" aria-label="close">close</mat-icon>
            <div class="msf-dashboard-button-move-icon" *ngIf="!globals.readOnlyDashboard" (click)="disableContextMenu()"></div>
          </div>
          <button *ngIf="panel.isLoading" mat-button class="cancel-button" (click)="cancelLoading(panel)">
            Cancel
            <mat-icon class="close-icon">close</mat-icon> 
          </button>
        </div>
        <div class="msf-dashboard-panel-button" *ngIf="!globals.readOnlyDashboard">
          <mat-icon class="msf-dashboard-button-close-icon" (click)="removePanel(panel.id)" aria-label="close">close</mat-icon>
          <div class="msf-dashboard-button-move-icon" (click)="disableContextMenu()"></div>
        </div>
        <app-msf-dashboard-panel [values]="panel" [controlPanelVariables]="controlPanelVariables" [panelWidth]="panel.width" [panelHeight]="panel.height"
          [currentHiddenCategories]="currentHiddenCategories" [addingOrRemovingPanels]="addingOrRemovingPanels" (removeDeadVariablesAndCategories)="removeDeadVariablesAndCategories($event)"
          (addNewVariablesAndCategories)="addNewVariablesAndCategories($event)" (toggleControlVariableDialogOpen)="toggleControlVariableDialogOpen($event)">
        </app-msf-dashboard-panel>
      </div>
    </div>
    <div class="msf-dashboard-empty" *ngIf="!dashboardPanels.length">
      <ng-container *ngIf="!globals.readOnlyDashboard">
        You have not added any panel.<br>
        Click here to start!
      </ng-container>
      <ng-container *ngIf="globals.readOnlyDashboard">
        There are no panels on this dashboard.
      </ng-container>
    </div>
    <div class="msf-dashboard-addmenu" *ngIf="!globals.readOnlyDashboard">
      <div class="msf-dashboard-addmenu-item" (click)="addPanel()">
        <div class="msf-dashboard-addmenu-item-text">
          <mat-icon class="msf-dashboard-icon" aria-label="add">add</mat-icon>
          <span class="msf-dashboard-addmenu-item-addtext">ADD PANEL</span>
        </div>
      </div>
    </div>
    <div *ngIf="displayContextMenu">
      <div class="msf-dashboard-panel-context-menu" [style.left.px]="getContextMenuPosX()" [style.top.px]="getContextMenuPosY()">
        <div id="msf-dashboard-panel-context-menu-container">
          <div class="msf-dashboard-panel-context-menu-top-bound"></div>
          <button class="msf-dashboard-panel-context-menu-item" mat-menu-item *ngFor="let item of contextMenuItems" (click)="displayChildPanel(item.id)">
            <span>{{item.title}}</span>
          </button>
          <div class="msf-dashboard-panel-context-menu-bottom-bound"></div>
        </div>
      </div>
    </div>
  </div>
</div>